<div class="container">
  <h2 class="section-title">
    <span class="vertical-bar"></span>
    Liste des Salles
  </h2>

  <button class="btn btn-primary" (click)="openModal()">Ajouter Salle</button>

  <table class="styled-table" *ngIf="salles.length > 0">
        <thead>
      <tr>
      <th>Salle</th>
      <th>Capacité</th>
      <th>Bloc</th>
      <th>Étage</th>
      <th>Actions</th>
      </tr>

    </thead>
    <tbody>
        <tr *ngFor="let salle of salles">
          <td>{{ salle.nom }}</td>
          <td>{{ salle.capacite }}</td>
          <td>{{ salle.bloc }}</td>
          <td>{{ salle.etage }}</td>
          <td>
          <button class="btn btn-primary" (click)="openReservationModal(salle)">Réserver</button>
          </td>
        </tr>

    </tbody>
  </table>

  <!-- ✅ Modal Ajout Salle -->
  <div class="modal-backdrop" *ngIf="isModalOpen" (click)="closeModal()"></div>
  <div class="modal" *ngIf="isModalOpen">
    <div class="modal-header">
      <h3>Ajouter une Salle</h3>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>

    <form [formGroup]="salleForm" (ngSubmit)="onSubmit()" class="modal-body" novalidate>

      <div class="form-group">
  <label for="bloc">Bloc</label>
  <select id="bloc" class="form-control" formControlName="bloc">
    <option value="" disabled selected>-- Choisir un bloc --</option>
    <option *ngFor="let bloc of blocsEsprit" [value]="bloc">Bloc {{ bloc }}</option>
  </select>
  <div class="text-danger" *ngIf="salleForm.get('bloc')?.invalid && salleForm.get('bloc')?.touched">
    Le bloc est requis.
  </div>
</div>



    <div class="form-group">
  <label for="etage">Étage</label>
  <select id="etage" class="form-control" formControlName="etage">
    <option value="" disabled selected>-- Choisir un étage --</option>
    <option *ngFor="let etage of [1, 2, 3, 4]" [value]="etage">Étage {{ etage }}</option>
  </select>
  <div class="text-danger" *ngIf="salleForm.get('etage')?.invalid && salleForm.get('etage')?.touched">
    Étage requis.
  </div>
</div>



      <div class="form-group">
        <label>Salle</label>
        <input type="text" formControlName="nom" />
        <div class="error" *ngIf="salleForm.get('nom')?.invalid && salleForm.get('nom')?.touched">
          Nom requis
        </div>
      </div>

      <div class="form-group">
        <label>Capacité</label>
        <input type="number" formControlName="capacite" />
        <div class="error" *ngIf="salleForm.get('capacite')?.invalid && salleForm.get('capacite')?.touched">
          Capacité requise (≥ 1)
        </div>
      </div>

        

      <button type="submit" [disabled]="salleForm.invalid" class="btn btn-primary">Enregistrer</button>
    </form>
  </div>

  <!-- ✅ Modal Réservation Salle -->
  <div class="modal-backdrop" *ngIf="isReservationModalOpen"></div>
  <div class="modal" *ngIf="isReservationModalOpen">
    <div class="modal-header">
      <h3>Réserver la salle : {{ selectedSalle?.nom }}</h3>
      <button class="close-btn" (click)="closeReservationModal()">&times;</button>
    </div>

    <form [formGroup]="reservationForm" (ngSubmit)="onSubmitReservation()" class="modal-body" novalidate>
      <div class="form-group">
        <label>Date Examen</label>
        <input type="date" formControlName="dateExamen" />
        <div class="error" *ngIf="reservationForm.get('dateExamen')?.invalid && reservationForm.get('dateExamen')?.touched">
          La date est requise.
        </div>
      </div>

      <div class="form-group">
        <label>Heure Début</label>
        <input type="time" formControlName="heureDebut" />
        <div class="error" *ngIf="reservationForm.get('heureDebut')?.invalid && reservationForm.get('heureDebut')?.touched">
          Heure début requise.
        </div>
      </div>

      <div class="form-group">
        <label>Heure Fin</label>
        <input type="time" formControlName="heureFin" />
        <div class="error" *ngIf="reservationForm.get('heureFin')?.invalid && reservationForm.get('heureFin')?.touched">
          Heure fin requise.
        </div>
      </div>

      

      <div class="form-group">
        <label>Matricule Enseignant</label>
        <input type="text" formControlName="matricule" />
        <div class="error" *ngIf="reservationForm.get('matricule')?.invalid && reservationForm.get('matricule')?.touched">
          Matricule requis.
        </div>
      </div>

      <button type="submit" [disabled]="reservationForm.invalid" class="btn btn-primary" style="width: 100%;">
        Confirmer la réservation
      </button>
    </form>
  </div>

  <!-- ✅ Pop-up d'erreur backend -->
  <div *ngIf="reservationErrorMessage" class="popup-error">
    <div class="popup-content">
      <span class="close-popup" (click)="reservationErrorMessage = null">&times;</span>
      <p>{{ reservationErrorMessage }}</p>
    </div>
  </div>
</div>
